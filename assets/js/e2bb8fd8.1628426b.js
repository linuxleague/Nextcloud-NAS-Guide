"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8526],{3905:function(e,t,o){o.d(t,{Zo:function(){return u},kt:function(){return d}});var r=o(7294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(o),d=n,f=m["".concat(l,".").concat(d)]||m[d]||c[d]||a;return o?r.createElement(f,i(i({ref:t},u),{},{components:o})):r.createElement(f,i({ref:t},u))}));function d(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=o.length,i=new Array(a);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var p=2;p<a;p++)i[p]=o[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,o)}m.displayName="MDXCreateElement"},2359:function(e,t,o){o.r(t),o.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return c}});var r=o(7462),n=o(3366),a=(o(7294),o(3905)),i=["components"],s={id:"restore-files",title:"How to restore files from backup?",sidebar_label:"Restore files"},l=void 0,p={unversionedId:"restore-files",id:"restore-files",title:"How to restore files from backup?",description:"It can happen that you need to restore some files from a backup. This is especially useful if you want to restore some private files. Hint: if your system is broken and something doesn't work correctly, you should follow How to restore the system from a backup",source:"@site/docs/restore-files.md",sourceDirName:".",slug:"/restore-files",permalink:"/Nextcloud-NAS-Guide/docs/restore-files",draft:!1,editUrl:"https://github.com/szaimen/Nextcloud-NAS-Guide/edit/main/docs/restore-files.md",tags:[],version:"current",frontMatter:{id:"restore-files",title:"How to restore files from backup?",sidebar_label:"Restore files"},sidebar:"docs",previous:{title:"Create Backup manually",permalink:"/Nextcloud-NAS-Guide/docs/manual-backup"},next:{title:"Restore system",permalink:"/Nextcloud-NAS-Guide/docs/restore-system"}},u={},c=[{value:"Preparations",id:"preparations",level:3},{value:"Execution",id:"execution",level:3}],m={toc:c};function d(e){var t=e.components,o=(0,n.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},m,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"It can happen that you need to restore some files from a backup. This is especially useful if you want to restore some private files. Hint: if your system is broken and something doesn't work correctly, you should follow ",(0,a.kt)("a",{parentName:"p",href:"./restore-system"},"How to restore the system from a backup")),(0,a.kt)("h3",{id:"preparations"},"Preparations"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Install Remotedesktop (",(0,a.kt)("a",{parentName:"li",href:"./remotedesktop"},"instructions"),")")),(0,a.kt)("h3",{id:"execution"},"Execution"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Run over CLI:",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"sudo bash /var/scripts/not-supported.sh\n"))),(0,a.kt)("li",{parentName:"ol"},"Choose ",(0,a.kt)("inlineCode",{parentName:"li"},"Backup Viewer")),(0,a.kt)("li",{parentName:"ol"},"Confirm that you want to view the content of your backups"),(0,a.kt)("li",{parentName:"ol"},"Choose ",(0,a.kt)("inlineCode",{parentName:"li"},"Remotedesktop")," if you get asked which way do you prefer of showing your backups."),(0,a.kt)("li",{parentName:"ol"},"If both backup drives are connected, ",(0,a.kt)("strong",{parentName:"li"},"select the backup drive")," that you want to view backups from (most likely the daily backup drive)"),(0,a.kt)("li",{parentName:"ol"},"Now you should see the advice ",(0,a.kt)("strong",{parentName:"li"},"how to use Remotedesktop")," to access your backup files. Simply leave this window open for now! (",(0,a.kt)("strong",{parentName:"li"},"don't")," press ",(0,a.kt)("inlineCode",{parentName:"li"},"[ENTER]")," to continue here, yet! If you should do this by mistake, you need to restart at step 1 again.)"),(0,a.kt)("li",{parentName:"ol"},"Connect to your server via RDP (",(0,a.kt)("a",{parentName:"li",href:"./rdp-connect"},"instructions"),")"),(0,a.kt)("li",{parentName:"ol"},"When you are connected, open a ",(0,a.kt)("inlineCode",{parentName:"li"},"terminal")," in the Remotedesktop session "),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("admonition",{parentName:"li",title:"File Manager",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"This is useful if you just want to inspect some files from backup or restore some files from the backup. If you need to restore complete folders, folder sync makes more sense. See below."),(0,a.kt)("ol",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Copy and paste")," or type into the terminal: ",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"xhost +si:localuser:root && sudo nautilus /tmp/borg\n"))),(0,a.kt)("li",{parentName:"ol"},"Now, after entering your password, you should see the file manager with all available backup archives "),(0,a.kt)("li",{parentName:"ol"},"You are now free to navigate through them, ",(0,a.kt)("strong",{parentName:"li"},"open files and restore")," them from the backup to the original directory (You can open a second file manager window by pressing ",(0,a.kt)("inlineCode",{parentName:"li"},"[CTRL] + [n]")," which makes it easier to copy files/folders between different locations)"),(0,a.kt)("li",{parentName:"ol"},"After you are done, ",(0,a.kt)("strong",{parentName:"li"},"close")," the file manager and the terminal in the RDP-session and exit the Remotedesktop session"))),"or",(0,a.kt)("admonition",{parentName:"li",title:"Folder Sync",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"This is useful if you want to restore complete folders from a backup."),(0,a.kt)("ol",{parentName:"admonition"},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"Copy and paste")," or type into the terminal: ",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"xhost +si:localuser:root && sudo grsync\n"))),(0,a.kt)("li",{parentName:"ol"},"Now, after entering your password, you should see Grsync which is a graphical User Interface for rsync - a Linux sync tool."),(0,a.kt)("li",{parentName:"ol"},"First, select your source directory by typing ",(0,a.kt)("inlineCode",{parentName:"li"},"/tmp/borg/")," into the first input box and clicking on ",(0,a.kt)("inlineCode",{parentName:"li"},"Open")," (next to the 1st input field). You will now see all available archives and should select a specific folder inside an archive. An example would look like this: ",(0,a.kt)("inlineCode",{parentName:"li"},"/tmp/borg/YYYYMMdd_hhmmss-NcVM-mnt-data-directory/mnt/data/subfolder"),". Make sure that after choosing the folder, you enter a slash ",(0,a.kt)("inlineCode",{parentName:"li"},"/")," at the end of the source directory, so that you sync the content of this folder and not the folder itself. This example would need look like this: ",(0,a.kt)("inlineCode",{parentName:"li"},"/tmp/borg/YYYYMMdd_hhmmss-NcVM-mnt-data-directory/mnt/data/subfolder/"),"."),(0,a.kt)("li",{parentName:"ol"},"Now, select your destination directory by typing ",(0,a.kt)("inlineCode",{parentName:"li"},"/mnt/data/")," (or any other path) into the second input box and clicking on ",(0,a.kt)("inlineCode",{parentName:"li"},"Open")," (next to the 2nd input field). Then you can select a subfolder that you want to sync. One example is: ",(0,a.kt)("inlineCode",{parentName:"li"},"/mnt/data/subfolder"),"."),(0,a.kt)("li",{parentName:"ol"},"Now adjust the rsync settings to fit your sync usecase. For restoring the complete source directory into the destination directory, the following options are recommended to be enabled (all other options should be disabled):",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u2611 Preserve Time"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Preserve owner"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Delete on destination"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Verbose"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Preserve permissions"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Preserve group"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Do not leave filesystem"),(0,a.kt)("li",{parentName:"ul"},"\u2611 Show transfer progress"))),(0,a.kt)("li",{parentName:"ol"},"Now, click on the \u2139 button (with the ",(0,a.kt)("strong",{parentName:"li"},"information icon"),") to start the ",(0,a.kt)("inlineCode",{parentName:"li"},"dry-run"),". This will check which files/folders are going to be modified/deleted/created but not start the sync process, yet. A popup should open that shows files/folders that are going to be modified/deleted/created."),(0,a.kt)("li",{parentName:"ol"},"If you are okay with the result, you can click on the button on the right, right next to the \u2139 button (the button with ",(0,a.kt)("strong",{parentName:"li"},"two gearwheels"),") to start the sync process."),(0,a.kt)("li",{parentName:"ol"},"After you are done, ",(0,a.kt)("strong",{parentName:"li"},"close")," Grsync and the terminal in the RDP-session and exit the Remotedesktop session")))),(0,a.kt)("li",{parentName:"ol"},"The last step is to exit the Backup Viewer script by pressing ",(0,a.kt)("inlineCode",{parentName:"li"},"[ENTER]"),(0,a.kt)("admonition",{parentName:"li",type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"It is crucial that you exit the Backup Viewer script correctly. Otherwise there might be problems on the next regular backup!"))),(0,a.kt)("li",{parentName:"ol"},"It should now report, that the backup and drive was successfully unmounted.")))}d.isMDXComponent=!0}}]);