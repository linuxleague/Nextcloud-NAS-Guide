"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8541],{3905:function(e,t,o){o.d(t,{Zo:function(){return u},kt:function(){return h}});var n=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,a=function(e,t){if(null==e)return{};var o,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=n.createContext({}),p=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var o=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(o),h=a,m=c["".concat(s,".").concat(h)]||c[h]||d[h]||r;return o?n.createElement(m,i(i({ref:t},u),{},{components:o})):n.createElement(m,i({ref:t},u))}));function h(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=o.length,i=new Array(r);i[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<r;p++)i[p]=o[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}c.displayName="MDXCreateElement"},5117:function(e,t,o){o.r(t),o.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return h},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var n=o(7462),a=o(3366),r=(o(7294),o(3905)),i=["components"],l={id:"pivpn",title:"How to install PiVPN?",sidebar_label:"PiVPN"},s=void 0,p={unversionedId:"pivpn",id:"pivpn",title:"How to install PiVPN?",description:"PiVPN is an easy way to create a VPN server that lets you access your home network from away and also lets you use the Pi-hole when connected via VPN as DNS-server so that you get ads- and tracker-blocking also when you are not at home.",source:"@site/docs/pivpn.md",sourceDirName:".",slug:"/pivpn",permalink:"/Nextcloud-NAS-Guide/docs/pivpn",draft:!1,editUrl:"https://github.com/szaimen/Nextcloud-NAS-Guide/edit/main/docs/pivpn.md",tags:[],version:"current",frontMatter:{id:"pivpn",title:"How to install PiVPN?",sidebar_label:"PiVPN"},sidebar:"docs",previous:{title:"Pi-hole",permalink:"/Nextcloud-NAS-Guide/docs/pi-hole"},next:{title:"PLEX Media Server",permalink:"/Nextcloud-NAS-Guide/docs/pms"}},u={},d=[{value:"Preparation",id:"preparation",level:3},{value:"Installation",id:"installation",level:3},{value:"What to do now?",id:"what-to-do-now",level:3}],c={toc:d};function h(e){var t=e.components,o=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},c,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"PiVPN is an easy way to create a VPN server that lets you access your home network from away and also lets you use the Pi-hole when connected via VPN as DNS-server so that you get ads- and tracker-blocking also when you are not at home."),(0,r.kt)("h3",{id:"preparation"},"Preparation"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install Pi-hole (else, you will not be able to use Pi-hole as DNS-server when connected over VPN) (",(0,r.kt)("a",{parentName:"li",href:"./pi-hole"},"instructions"),")"),(0,r.kt)("li",{parentName:"ol"},"Port-forward port 51820 UDP to your server (",(0,r.kt)("a",{parentName:"li",href:"./port-forwarding"},"instructions"),")"),(0,r.kt)("li",{parentName:"ol"},"Create a Backup (",(0,r.kt)("a",{parentName:"li",href:"./manual-backup"},"instructions"),")\n(better to be prepared, since we use the scripts provided by the PiVPN project and something could go wrong. You never now!)"),(0,r.kt)("li",{parentName:"ol"},"Be at the place were your server is located and connect a display and keyboard because you may need to enroll a so called ",(0,r.kt)("inlineCode",{parentName:"li"},"MOK")," the next time your server starts so automatic startup will not be possible")),(0,r.kt)("h3",{id:"installation"},"Installation"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Run over CLI:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo bash /var/scripts/not-supported.sh\n"))),(0,r.kt)("li",{parentName:"ol"},"Choose ",(0,r.kt)("inlineCode",{parentName:"li"},"PiVPN")),(0,r.kt)("li",{parentName:"ol"},"Choose to install PiVPN"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Selected")," that you have created a Backup"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Don't")," use ",(0,r.kt)("inlineCode",{parentName:"li"},"UPNP")," to open the required port since you've already done this manually"),(0,r.kt)("li",{parentName:"ol"},"Choose ",(0,r.kt)("inlineCode",{parentName:"li"},"Yes")," if you get asked if you want to continue even if the script is not possibel to check automatically if the port is open"),(0,r.kt)("li",{parentName:"ol"},"Wait until a few things are installed"),(0,r.kt)("li",{parentName:"ol"},"If you get asked for IPv6 leak, select ",(0,r.kt)("inlineCode",{parentName:"li"},"Yes")," to route everything through the VPN even if the server is not configured for IPv6"),(0,r.kt)("li",{parentName:"ol"},"Wait until a few things are installed"),(0,r.kt)("li",{parentName:"ol"},"Select the ",(0,r.kt)("strong",{parentName:"li"},"interface")," for PiVPN (should be called ",(0,r.kt)("inlineCode",{parentName:"li"},"eno1")," or something like that)"),(0,r.kt)("li",{parentName:"ol"},"Wait until a few more things are installed (and create an UEFI password, if you are asked to do so)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Confirm")," that you want to use Pi-hole as DNS-server for PiVPN"),(0,r.kt)("li",{parentName:"ol"},"Wait until it reports that PiVPN was set up correctly and read through the information"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Confirm")," that you want to reboot now")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"It can happen that your server won't startup automatically at this point, if you had to create an UEFI password during the installation. If this happens, do the following steps:"),(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"On the server startup, you should see the ",(0,r.kt)("inlineCode",{parentName:"li"},"MOK-management-console")),(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("inlineCode",{parentName:"li"},"Enroll MOK")),(0,r.kt)("li",{parentName:"ol"},"Select ",(0,r.kt)("inlineCode",{parentName:"li"},"Yes")," when asked ",(0,r.kt)("inlineCode",{parentName:"li"},"Enroll the Key(s)?")),(0,r.kt)("li",{parentName:"ol"},"Enter the UEFI password, that you've created"),(0,r.kt)("li",{parentName:"ol"},"reboot")),(0,r.kt)("p",{parentName:"admonition"},"Now your server should automatically boot again.")),(0,r.kt)("h3",{id:"what-to-do-now"},"What to do now?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"As suggested, to add a new VPN-profile, you should run the following over CLI and follow the instructions:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo pivpn -a\n"))),(0,r.kt)("li",{parentName:"ul"},"After you've added all needed profiles (you need one per device, don't reuse profiles on different devices!), you can show them by running the following over CLI and follow the instructions:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"sudo pivpn -qr\n")),"  You should finally see a ",(0,r.kt)("strong",{parentName:"li"},"QR code"),", that you can scan with the ",(0,r.kt)("strong",{parentName:"li"},"Wireguard mobile app")," that you can download in the ",(0,r.kt)("inlineCode",{parentName:"li"},"Play Store")," on Android and ",(0,r.kt)("inlineCode",{parentName:"li"},"App Store")," on iOS"),(0,r.kt)("li",{parentName:"ul"},"After scanning the QR-code, the VPN-profile should be added to the Wireguard app and you should be able to connect to your home network from anywhere.")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you've chosen to use Pi-hole as DNS server for the VPN connection during the setup, it is possible that your smartphones Nextcloud app won't be able to connect to your Nextcloud when it is connected via Wireguard to your home network. To fix this, you should create a ",(0,r.kt)("inlineCode",{parentName:"p"},"Local DNS Record\xb4 in your Pi-hole that points "),"yourdomain.com",(0,r.kt)("inlineCode",{parentName:"p"},"to the IP-address"),"10.6.0.1`. Afterwards it should work.")),(0,r.kt)("admonition",{title:"Notebooks",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"You can also use those profiles on your Notebook to get access to your home network via VPN.",(0,r.kt)("br",null),"\nThe simplest way to do this is the following:"),(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"Create a new VPN profile for your Notebook and show its QR code (as instructed above)"),(0,r.kt)("li",{parentName:"ol"},"Scan the QR code of this profile with your smartphones Wireguard app"),(0,r.kt)("li",{parentName:"ol"},"Export all Tunnels from your smartphones Wireguard app settings"),(0,r.kt)("li",{parentName:"ol"},"Copy the zip file to a location where your Notebook has access to",(0,r.kt)("br",null),"\n(Best is to use SMB for this. It should be a directory that doesn't get synchronized via the Nextcloud Desktop client and that is not shared with another user.) "),(0,r.kt)("li",{parentName:"ol"},"Import the correct tunnel into the Wireguard Desktop app from there. "),(0,r.kt)("li",{parentName:"ol"},"It is recommended to delete the zip file from your phone and any place where you have copied it now since the profile files are very dangerous if an attacker gets them. So make sure the profiles only exist in the Wireguard apps afterwards. (And don't forget the trash bins!)"))))}h.isMDXComponent=!0}}]);