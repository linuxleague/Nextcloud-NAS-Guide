<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/Nextcloud-NAS-Guide/news/rss.xml" title="Nextcloud-NAS-Guide Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Nextcloud-NAS-Guide/news/atom.xml" title="Nextcloud-NAS-Guide Blog Atom Feed"><title data-react-helmet="true">How to install PiVPN? | Nextcloud-NAS-Guide</title><meta data-react-helmet="true" property="og:url" content="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/pivpn"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to install PiVPN? | Nextcloud-NAS-Guide"><meta data-react-helmet="true" name="description" content="PiVPN is an easy way to create a VPN server that lets you access your home network from away and also lets you use the Pi-hole when connected via VPN as DNS-server so that you get ads- and tracker-blocking also when you are not at home."><meta data-react-helmet="true" property="og:description" content="PiVPN is an easy way to create a VPN server that lets you access your home network from away and also lets you use the Pi-hole when connected via VPN as DNS-server so that you get ads- and tracker-blocking also when you are not at home."><link data-react-helmet="true" rel="shortcut icon" href="/Nextcloud-NAS-Guide/img/favicon.webp"><link data-react-helmet="true" rel="canonical" href="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/pivpn"><link data-react-helmet="true" rel="alternate" href="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/pivpn" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://szaimen.github.io/Nextcloud-NAS-Guide/docs/pivpn" hreflang="x-default"><link rel="stylesheet" href="/Nextcloud-NAS-Guide/assets/css/styles.2b2e5844.css">
<link rel="preload" href="/Nextcloud-NAS-Guide/assets/js/runtime~main.9a3c7d5b.js" as="script">
<link rel="preload" href="/Nextcloud-NAS-Guide/assets/js/main.c082178d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Nextcloud-NAS-Guide/"><img src="/Nextcloud-NAS-Guide/img/favicon.webp" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Nextcloud-NAS-Guide/img/favicon.webp" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Nextcloud-NAS</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Nextcloud-NAS-Guide/docs/">Guide</a><a class="navbar__item navbar__link" href="/Nextcloud-NAS-Guide/news">News</a><a href="https://github.com/szaimen/Nextcloud-NAS-Guide/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Nextcloud-NAS-Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Before you start</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Basic setup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security and Automation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">External drives</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backup</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">SMB-server and user accounts</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Customize Nextcloud</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Activate Let&#x27;s Encrypt</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Optional</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Server Addons</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/firewall">Firewall</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/harden-ssh">Harden SSH</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/vaultwarden">Vaultwarden</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/pi-hole">Pi-hole</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Nextcloud-NAS-Guide/docs/pivpn">PiVPN</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/pms">PLEX Media Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Nextcloud-NAS-Guide/docs/remotedesktop">Remotedesktop</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Nextcloud Addons</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Miscellaneous</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">How to install PiVPN?</h1></header><p>PiVPN is an easy way to create a VPN server that lets you access your home network from away and also lets you use the Pi-hole when connected via VPN as DNS-server so that you get ads- and tracker-blocking also when you are not at home.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="preparation"></a>Preparation<a class="hash-link" href="#preparation" title="Direct link to heading">#</a></h3><ol><li>Install Pi-hole (else, you will not be able to use Pi-hole as DNS-server when connected over VPN) (<a href="/Nextcloud-NAS-Guide/docs/pi-hole">instructions</a>)</li><li>Port-forward port 51820 UDP to your server (<a href="/Nextcloud-NAS-Guide/docs/port-forwarding">instructions</a>)</li><li>Create a Backup (<a href="/Nextcloud-NAS-Guide/docs/manual-backup">instructions</a>)
(better to be prepared, since we use the scripts provided by the PiVPN project and something could go wrong. You never now!)</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="installation"></a>Installation<a class="hash-link" href="#installation" title="Direct link to heading">#</a></h3><ol><li>Run over CLI:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">bash</span><span class="token plain"> /var/scripts/not-supported.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Choose <code>PiVPN</code></li><li>Choose to install PiVPN</li><li><strong>Selected</strong> that you have created a Backup</li><li><strong>Don&#x27;t</strong> use <code>UPNP</code> to open the required port since you&#x27;ve already done this manually</li><li>Wait until a few things are installed</li><li>Select the <strong>interface</strong> for PiVPN (should be called <code>eno1</code> or something like that)</li><li>Wait until a few more things are installed (and create an UEFI password, if you are asked to do so)</li><li><strong>Confirm</strong> that you want to use Pi-hole as DNS-server for PiVPN</li><li>Wait until it reports that PiVPN was set up correctly and read through the information</li><li><strong>Confirm</strong> that you want to reboot now</li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>It can happen that your server won&#x27;t startup automatically at this point, if you had to create an UEFI password during the installation. If this happens, do the following steps:</p><ol><li>On the server startup, you should see the <code>MOK-management-console</code></li><li>Select <code>Enroll MOK</code></li><li>Select <code>Yes</code> when asked <code>Enroll the Key(s)?</code></li><li>Enter the UEFI password, that you&#x27;ve created</li><li>reboot</li></ol><p>Now your server should automatically boot again.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-to-do-now"></a>What to do now?<a class="hash-link" href="#what-to-do-now" title="Direct link to heading">#</a></h3><ul><li>As suggested, to add a new VPN-profile, you should run the following over CLI and follow the instructions:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> pivpn -a</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>After you&#x27;ve added all needed profiles (you need one per device, don&#x27;t reuse profiles on different devices!), you can show them by running the following over CLI and follow the instructions:<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> pivpn -qr</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div>  You should finally see a <strong>QR code</strong>, that you can scan with the <strong>Wireguard mobile app</strong> that you can download in the <code>Play Store</code> on Android and <code>App Store</code> on iOS</li><li>After scanning the QR-code, the VPN-profile should be added to the Wireguard app and you should be able to connect to your home network from anywhere.</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>If you&#x27;ve chosen to use Pi-hole as DNS server for the VPN connection during the setup, it is possible that your smartphones Nextcloud app won&#x27;t be able to connect to your Nextcloud when it is connected via Wireguard to your home network. To fix this, you should create a <code>Local DNS RecordÂ´ in your Pi-hole that points </code>yourdomain.com<code>to the IP-address</code>10.6.0.1`. Afterwards it should work.</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Notebooks</h5></div><div class="admonition-content"><p>You can also use those profiles on your Notebook to get access to your home network via VPN.<br>
The simplest way to do this is the following:</p><ol><li>Create a new VPN profile for your Notebook and show its QR code (as instructed above)</li><li>Scan the QR code of this profile with your smartphones Wireguard app</li><li>Export all Tunnels from your smartphones Wireguard app settings</li><li>Copy the zip file to a location where your Notebook has access to<br>
(Best is to use SMB for this. It should be a directory that doesn&#x27;t get synchronized via the Nextcloud Desktop client and that is not shared with another user.) </li><li>Import the correct tunnel into the Wireguard Desktop app from there. </li><li>It is recommended to delete the zip file from your phone and any place where you have copied it now since the profile files are very dangerous if an attacker gets them. So make sure the profiles only exist in the Wireguard apps afterwards. (And don&#x27;t forget the trash bins!)</li></ol></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/szaimen/Nextcloud-NAS-Guide/edit/main/docs/pivpn.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Nextcloud-NAS-Guide/docs/pi-hole"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Pi-hole</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Nextcloud-NAS-Guide/docs/pms"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">PLEX Media Server Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preparation" class="table-of-contents__link">Preparation</a></li><li><a href="#installation" class="table-of-contents__link">Installation</a></li><li><a href="#what-to-do-now" class="table-of-contents__link">What to do now?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Nextcloud-NAS-Guide/docs/impressum">Impressum</a></li><li class="footer__item"><a class="footer__link-item" href="/Nextcloud-NAS-Guide/docs/privacy">Privacy Policy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 <a href="https://github.com/szaimen">szaimen</a> - Built with Docusaurus.</div></div></div></footer></div>
<script src="/Nextcloud-NAS-Guide/assets/js/runtime~main.9a3c7d5b.js"></script>
<script src="/Nextcloud-NAS-Guide/assets/js/main.c082178d.js"></script>
</body>
</html>