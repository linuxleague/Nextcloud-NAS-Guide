(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{172:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),b=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=b(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=b(a),d=n,m=p["".concat(i,".").concat(d)]||p[d]||u[d]||o;return a?r.a.createElement(m,s(s({ref:t},l),{},{components:a})):r.a.createElement(m,s({ref:t},l))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var l=2;l<o;l++)i[l]=a[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"},75:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return s})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return b}));var n=a(3),r=a(7),o=(a(0),a(172)),i={id:"restore-backup",title:"How to restore a Backup on a different server or upgrade Ubuntu?",sidebar_label:"Restore Backup/Upgrade Ubuntu"},s={unversionedId:"restore-backup",id:"restore-backup",isDocsHomePage:!1,title:"How to restore a Backup on a different server or upgrade Ubuntu?",description:"Theoretically it could happen that your system drive fails or that you need to update the Ubuntu version.",source:"@site/docs/restore-backup.md",slug:"/restore-backup",permalink:"/Nextcloud-NAS-Guide/docs/restore-backup",editUrl:"https://github.com/szaimen/Nextcloud-NAS-Guide/edit/main/docs/restore-backup.md",version:"current",sidebar_label:"Restore Backup/Upgrade Ubuntu",sidebar:"docs",previous:{title:"How to connect via Remotedesktop to your server?",permalink:"/Nextcloud-NAS-Guide/docs/rdp-connect"}},c=[{value:"Preparations (if your server doesn&#39;t work because of a failed system drive)",id:"preparations-if-your-server-doesnt-work-because-of-a-failed-system-drive",children:[]},{value:"Preparations (if you want to upgrade Ubuntu)",id:"preparations-if-you-want-to-upgrade-ubuntu",children:[]},{value:"Execution",id:"execution",children:[]},{value:"Reinstall Apps and Addons",id:"reinstall-apps-and-addons",children:[{value:"Necessary are those",id:"necessary-are-those",children:[]},{value:"Optional are those",id:"optional-are-those",children:[]}]}],l={toc:c};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Theoretically it could happen that your system drive fails or that you need to update the Ubuntu version.\nIn those cases you need to reinstall Ubuntu and thus restore a backup on a different server (it looks like it is a different server for the scripts)."),Object(o.b)("p",null,"Here is what you need to do in those cases:"),Object(o.b)("h2",{id:"preparations-if-your-server-doesnt-work-because-of-a-failed-system-drive"},"Preparations (if your server doesn't work because of a failed system drive)"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Buy a new with your server compatible internal SSD (recommended specifications describe ",Object(o.b)("a",{parentName:"li",href:"./hardware-recommendations#general-hardware-recommendations"},"here"),")"),Object(o.b)("li",{parentName:"ol"},"Put the new drive into your server")),Object(o.b)("h2",{id:"preparations-if-you-want-to-upgrade-ubuntu"},"Preparations (if you want to upgrade Ubuntu)"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Create a backup of your server (",Object(o.b)("a",{parentName:"li",href:"./manual-backup"},"instructions"),")",Object(o.b)("div",{parentName:"li",className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"Only create the Backup if the whole server still works as expected. If something doesn't work, restore a system backup first (by following ",Object(o.b)("a",{parentName:"p",href:"./restore-system"},"those instructions"),"), before creating a new backup! (The latest backup must be in working condition!)")))),Object(o.b)("li",{parentName:"ol"},"Only if the backup (from step 1) was created successfully (otherwise skip this 2nd step!), get your ",Object(o.b)("inlineCode",{parentName:"li"},"Off-Shore Backup HDD"),", connect it to your server and create a new off-shore backup by running:",Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},"sudo sed -i 's|^DAYS_SINCE_LAST_BACKUP.*|DAYS_SINCE_LAST_BACKUP=1000|' /var/scripts/off-shore-rsync-backup.sh \\\n&& sudo bash /var/scripts/off-shore-rsync-backup.sh\n")),Object(o.b)("div",{parentName:"li",className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"You should really only create a new off-shore backup if the backup from step 1 was created successfully!")))),Object(o.b)("li",{parentName:"ol"},"Use your chance and find out if you still have the passphrase of your backup stored at a safe place by comparing it with the output of:",Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},'sudo grep "ENCRYPTION_KEY" /var/scripts/daily-borg-backup.sh\n')),"If you don't have it stored, just ",Object(o.b)("strong",{parentName:"li"},"note it down")," another time. This is crutial!",Object(o.b)("br",null),"\n(because this is the last chance to retrieve the password from your server)")),Object(o.b)("h2",{id:"execution"},"Execution"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Shut down")," your server by pressing the power button"),Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Disconnect")," all external drives from your server"),Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Execute")," the complete Basic setup section (",Object(o.b)("a",{parentName:"li",href:"./basic-setup"},"this section"),")",Object(o.b)("br",null),Object(o.b)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"Don't go any further and stop at the beginning of the next section!",Object(o.b)("br",null),"\n(This is the last step that shall get executed: ",Object(o.b)("a",{parentName:"p",href:"./usb-boot"},"click here"),")")))),Object(o.b)("li",{parentName:"ol"},"If you are done with the basic setup section, run the manual update once (",Object(o.b)("a",{parentName:"li",href:"./update-manually"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Please ",Object(o.b)("strong",{parentName:"li"},"don't")," connect the backup HDD to your server, yet or ",Object(o.b)("strong",{parentName:"li"},"disconnect")," the backup HDD from your server!"),Object(o.b)("li",{parentName:"ol"},"Now run the restore-backup script by executing:",Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre",className:"language-shell"},"wget https://raw.githubusercontent.com/nextcloud/vm/master/not-supported/restore-backup.sh \\\n&& sudo bash restore-backup.sh\n"))),Object(o.b)("li",{parentName:"ol"},"Enter your password"),Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Confirm")," that you want to restore your server from backup"),Object(o.b)("li",{parentName:"ol"},"Press ",Object(o.b)("inlineCode",{parentName:"li"},"OK")," to start searching for new backup drives"),Object(o.b)("li",{parentName:"ol"},"Now ",Object(o.b)("strong",{parentName:"li"},"connect")," one of your backup drives (most likely the daily backup HDD) to your server (you have 1 minute)"),Object(o.b)("li",{parentName:"ol"},"Choose the ",Object(o.b)("strong",{parentName:"li"},"NTFS partition")," that shall get mounted"),Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Select")," one found valid backup repository"),Object(o.b)("li",{parentName:"ol"},"Enter the ",Object(o.b)("strong",{parentName:"li"},"passphrase")," that was used to encrypt the backup"),Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Confirm")," that you want to check if the backup extracting works (only skip it if it takes too long: you can cancel it by pressing ",Object(o.b)("inlineCode",{parentName:"li"},"[CTRL] + [C]"),")"),Object(o.b)("li",{parentName:"ol"},Object(o.b)("strong",{parentName:"li"},"Confirm")," that you want to restore the backup"),Object(o.b)("li",{parentName:"ol"},"Now wait until you see the next popup! (This can take a while.)"),Object(o.b)("li",{parentName:"ol"},"It should now report that the restore was completed and you should connect all drives now. So please ",Object(o.b)("strong",{parentName:"li"},"connect all external drives")," now that were connected to your old server!"),Object(o.b)("li",{parentName:"ol"},"Press ",Object(o.b)("inlineCode",{parentName:"li"},"[ENTER]")," so that they get mounted"),Object(o.b)("li",{parentName:"ol"},"Now you should see a popup were it is recommended to open your nextcloud web interface to confirm that the restore was successful. Do so by opening the suggested link. E.g. ",Object(o.b)("inlineCode",{parentName:"li"},"https://192.168.178.144"),". After you've confirmed that Nextcloud works, press ",Object(o.b)("inlineCode",{parentName:"li"},"[ENTER]")),Object(o.b)("li",{parentName:"ol"},"Now it will report to you that you need to reinstall a lot of apps/addons in case they were installed on your old server. This is what you will do next. Press ",Object(o.b)("inlineCode",{parentName:"li"},"[ENTER]")," to exit the script.")),Object(o.b)("h2",{id:"reinstall-apps-and-addons"},"Reinstall Apps and Addons"),Object(o.b)("p",null,"If the Nextcloud web interface works as expected, you will need to reinstall all apps/addons that were installed on your old server."),Object(o.b)("h3",{id:"necessary-are-those"},"Necessary are those"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Reinstall Geoblocking (",Object(o.b)("a",{parentName:"li",href:"./geoblock"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reinstall Disk Monitoring (",Object(o.b)("a",{parentName:"li",href:"./smart"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reinstall Fail2Ban (",Object(o.b)("a",{parentName:"li",href:"./fail2ban"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reinstall ClamAV (",Object(o.b)("a",{parentName:"li",href:"./clamav"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reinstall SMTP Mail (",Object(o.b)("a",{parentName:"li",href:"./smtp-mail"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reinstall DDclient (",Object(o.b)("a",{parentName:"li",href:"./configure-ddclient"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reconfigure Port Forwarding (",Object(o.b)("a",{parentName:"li",href:"./port-forwarding"},"instructions"),")"),Object(o.b)("li",{parentName:"ol"},"Reactivate TLS for your Nextcloud Domain (",Object(o.b)("a",{parentName:"li",href:"./activate-tls"},"instructions"),")")),Object(o.b)("h4",{id:"now-your-nextcloud-should-work-again-completely"},"Now your Nextcloud should work again completely!"),Object(o.b)("h3",{id:"optional-are-those"},"Optional are those"),Object(o.b)("p",null,"(You only need to reinstall them ",Object(o.b)("strong",{parentName:"p"},"if they were installed before"),")"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Reinstall OnlyOffice for Nextcloud (",Object(o.b)("a",{parentName:"li",href:"./onlyoffice"},"instructions"),")"),Object(o.b)("li",{parentName:"ul"},"Reinstall High-Performance backend for Nextcloud Talk (",Object(o.b)("a",{parentName:"li",href:"./hpb"},"instructions"),")"),Object(o.b)("li",{parentName:"ul"},"Reinstall Push Notifications for Nextcloud (",Object(o.b)("a",{parentName:"li",href:"./notify_push"},"instructions"),")"),Object(o.b)("li",{parentName:"ul"},"Reinstall Bitwarden RS (",Object(o.b)("a",{parentName:"li",href:"./bitwarden-rs"},"instructions"),")",Object(o.b)("div",{parentName:"li",className:"admonition admonition-caution alert alert--warning"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"Attention! Please use the ",Object(o.b)("strong",{parentName:"p"},"same domain")," that you've used before for Bitwarden RS (if you've had Bitwarden installed on your old server!)")))),Object(o.b)("li",{parentName:"ul"},"Reinstall Plex Media Server (",Object(o.b)("a",{parentName:"li",href:"./pms"},"instructions"),")",Object(o.b)("div",{parentName:"li",className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",{parentName:"div",className:"admonition-heading"},Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",{parentName:"h5",className:"admonition-icon"},Object(o.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(o.b)("div",{parentName:"div",className:"admonition-content"},Object(o.b)("p",{parentName:"div"},"When reinstalling Plex, all drives that Plex shall have access to need to be mounted to the server! (Otherwise there could appear some problems.) You can make sure that this is the case by connecting all drives to your server and rebooting your sever before reinstalling Plex!")))),Object(o.b)("li",{parentName:"ul"},"Reinstall Remotedesktop (",Object(o.b)("a",{parentName:"li",href:"./remotedesktop"},"instructions"),")"),Object(o.b)("li",{parentName:"ul"},"Reinstall Pi-hole (",Object(o.b)("a",{parentName:"li",href:"./pi-hole"},"instructions"),")"),Object(o.b)("li",{parentName:"ul"},"Reinstall PiVPN (",Object(o.b)("a",{parentName:"li",href:"./pivpn"},"instructions"),")")))}b.isMDXComponent=!0}}]);